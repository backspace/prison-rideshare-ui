{{toolbar-header title='Reimbursements'}}

{{#if peopleAndReimbursements}}
  {{#paper-data-table as |table|}}
    {{#table.head as |head|}}
      {{#head.column}}Person{{/head.column}}
      {{#head.column}}Food{{/head.column}}
      {{#head.column}}Car{{/head.column}}
      {{#head.column}}Total{{/head.column}}
      {{head.column}}
    {{/table.head}}
    {{#table.body as |body|}}
      {{#each peopleAndReimbursements as |personAndReimbursements|}}
        {{#each personAndReimbursements as |personAndCollection index|}}
          {{#if personAndCollection.reimbursements}}
            {{#body.row class='person' as |row|}}
              {{#row.cell class='name'}}{{#if personAndCollection.showName}}{{personAndCollection.person.name}}{{/if}}{{/row.cell}}
              {{#row.cell class='food-expenses'}}{{#unless personAndCollection.donations}}{{personAndCollection.foodExpensesDollars}}{{/unless}}{{/row.cell}}
              {{#row.cell}}
                <span class='car-expenses'>{{personAndCollection.carExpensesDollars}}</span>
                {{#if personAndCollection.donations}}{{paper-icon 'card giftcard'}}{{/if}}
              {{/row.cell}}
              {{#row.cell class='total-expenses'}}{{personAndCollection.totalExpensesDollars}}{{/row.cell}}
              {{#row.cell}}
                {{#paper-button class='process' primary=(not personAndCollection.donations)onClick=(action 'processReimbursements' personAndCollection)}}
                  Process
                {{/paper-button}}
                {{#paper-button class='donate' primary=personAndCollection.donations onClick=(action 'processReimbursements' personAndCollection true)}}
                  Donate
                {{/paper-button}}
              {{/row.cell}}
            {{/body.row}}
          {{/if}}
        {{/each}}
      {{/each}}
    {{/table.body}}
  {{/paper-data-table}}
{{else}}
  {{#paper-data-table as |table|}}
    {{#table.body as |body|}}
      {{#body.row as |row|}}
        {{#row.cell class='no-reimbursements'}}There are no unprocessed reimbursements to view.{{/row.cell}}
      {{/body.row}}
    {{/table.body}}
  {{/paper-data-table}}
{{/if}}

{{#paper-switch class='processed' value=showProcessed onChange=(action (mut showProcessed))}}
  Show processed reimbursements
{{/paper-switch}}

{{#if showProcessed}}
  {{#paper-data-table as |table|}}
    {{#table.head as |head|}}
      {{#head.column}}Date{{/head.column}}
      {{#head.column}}Person{{/head.column}}
      {{#head.column}}Ride{{/head.column}}
      {{#head.column}}Expense{{/head.column}}
      {{#head.column}}Donation?{{/head.column}}
    {{/table.head}}
    {{#table.body as |body|}}
      {{#each processedReimbursements as |reimbursement|}}
        {{#body.row class='reimbursement' as |row|}}
          {{#row.cell class='date'}}{{moment-format reimbursement.insertedAt 'YYYY-MM-DD'}}{{/row.cell}}
          {{#row.cell class='name'}}{{reimbursement.person.name}}{{/row.cell}}
          {{#row.cell class='ride'}}{{#if (and reimbursement.ride.start reimbursement.ride.institution.name)}}{{moment-format reimbursement.ride.start 'YYYY-MM-DD'}} to {{reimbursement.ride.institution.name}}{{/if}}{{/row.cell}}
          {{#row.cell class='expenses'}}
            {{#if reimbursement.foodExpensesDollars}}
              {{paper-icon 'local cafe'}} <span>{{reimbursement.foodExpensesDollars}}</span>
            {{else}}
              {{paper-icon 'local gas station'}} <span>{{reimbursement.carExpensesDollars}}</span>
            {{/if}}
          {{/row.cell}}
          {{#row.cell class='donation'}}
            {{#if reimbursement.donation}}{{paper-icon 'done'}}{{/if}}
          {{/row.cell}}
        {{/body.row}}
      {{/each}}
    {{/table.body}}
  {{/paper-data-table}}
{{/if}}

{{#if editingReimbursement}}
{{reimbursement-form reimbursement=editingReimbursement
                     cancel=(action 'cancel')
                     save=(action 'submit')}}
{{/if}}
